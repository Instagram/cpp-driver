<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="DataStax C++ Driver for Apache Cassandra Documentation">
    <meta name="author" content="DataStax">

    <title>DataStax C/C++ Driver - User Defined Types (UDTs)</title>

    <link rel="icon" href="../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../favicon.png">
    <link href="../../../css/style.css" rel="stylesheet">
    <link href="../../../css/pygments.css" rel="stylesheet">
    <link href="../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs" data-spy="scroll" data-target=".side-nav">
    <header class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../">DataStax C/C++ Driver</a>
        </div>
        <div class="collapse navbar-collapse" ng-controller="search">
          <ul class="nav navbar-nav">
            
            
            
            <li class="active">
              <a href="../../">Topics</a>
            </li>
            
            
            <li>
              <a href="../../../api/">API docs</a>
            </li>
            
          </ul>
          <form class="navbar-form form-search navbar-right dropdown visible-lg-block" ng-class="{open: hasResults}" role="search" ng-submit="submit()">
            <div class="form-group has-feedback">
              <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('v2.1')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
            </div>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
            </ul>
          </form>
        </div>
      </div>
    </header>

    <div class="container" id="content">
      <div class="row">
        <div class="col-md-9 content">
          <nav class="crumbs">
            <ol class="breadcrumb">
              
              <li>
                <div class="dropdown">
                  <button id="current-version" class="btn btn-default btn-sm" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    v2.1
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                  
                    <li class="disabled"><a href="./">v2.1</a></li>
                  
                    <li><a href="../../../v2.0/">v2.0</a></li>
                  
                    <li><a href="../../../v1.0/">v1.0</a></li>
                  
                  </ul>
                </div>
              </li>
              
              
              
              
              <li><a href="../../../">Home</a></li>
              
              
              
              
              
              <li><a href="../../">Getting Started</a></li>
              
              
              
              
              
              <li><a href="../">Basics</a></li>
              
              
              
              
              
              <li class="active">User Defined Types (UDTs)</li>
              
              
              
            </ol>
          </nav>
          

<h1 id="user-defined-types-ud-ts">User Defined Types (UDTs)<a class="anchor" href="#user-defined-types-ud-ts" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>

<p>User defined types (UDT) can be used to create arbitrary user types with fields
that can be accessed by name or position. When used with the driver they can be
created from a previously defined type determined from schema or they can be
created from a manually defined data type.</p>

<h2 id="creating-a-udt-from-schema">Creating a UDT from Schema<a class="anchor" href="#creating-a-udt-from-schema" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>An <a href="../../../api/CassSchema/"><code>CassSchema</code></a> instance can be used to construct a new <a href="../../../api/CassUserType/"><code>CassUserType</code></a>. The
<a href="../../../api/CassSchema/"><code>CassSchema</code></a> instance returns a <a href="../../../api/CassDataType/"><code>CassDataType</code></a> object which is used to
describe Cassandra types including UDTs, tuples, collections and all basic types
(<code>int</code>, <code>bigint</code>, <code>uuid</code>, etc.).</p>
<pre class="highlight"><code><span class="nc">CassSchema</span><span class="o">*</span> <span class="n">schema</span> <span class="o">=</span> <span class="nb">cass_session_get_schema</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>

<span class="nc">CassDataType</span><span class="o">*</span> <span class="n">data_type</span> <span class="o">=</span> <span class="nb">cass_schema_get_udt</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s">"keyspace"</span><span class="p">,</span> <span class="s">"typename"</span><span class="p">);</span>

<span class="nc">CassUserType</span><span class="o">*</span> <span class="n">user_type</span> <span class="o">=</span> <span class="nb">cass_user_type_new_from_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>

<span class="cm">/* Bind values to user type fields and bind user type to a statement */</span>
</code></pre>
<h2 id="manually-constructing-a-udt-data-type">Manually Constructing a UDT Data Type<a class="anchor" href="#manually-constructing-a-udt-data-type" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>If schema metadata updates are disabled it is still possible to create UDTs
from a manually construct <a href="../../../api/CassDataType/"><code>CassDataType</code></a>.</p>
<pre class="highlight"><code><span class="nc">CassDataType</span><span class="o">*</span> <span class="n">data_type</span> <span class="o">=</span> <span class="nb">cass_data_type_new_udt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_INT</span><span class="p">);</span>
<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_UUID</span><span class="p">);</span>
<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field3"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_TEXT</span><span class="p">);</span>

<span class="nc">CassUserType</span><span class="o">*</span> <span class="n">user_type</span> <span class="o">=</span> <span class="nb">cass_user_type_new_from_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>

<span class="cm">/* Bind values to user type fields */</span>

<span class="nb">cass_data_type_free</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>
</code></pre>
<p>The preceding code is equivalent to defining the following schema and using
<a href="../../../api/CassSession/#cass-session-get-schema"><code>cass_session_get_schema()</code></a> obtain the data type.</p>
<pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">udt</span> <span class="p">(</span><span class="n">field1</span> <span class="k">int</span><span class="p">,</span> <span class="n">field2</span> <span class="k">uuid</span><span class="p">,</span> <span class="n">field3</span> <span class="k">text</span><span class="p">);</span>
</code></pre>
<h2 id="consuming-values-from-a-udt-result">Consuming values from a UDT result<a class="anchor" href="#consuming-values-from-a-udt-result" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>A UDT returned from Cassandra is consumed by iterating over its fields similar
to the way collections or tuples are consumed.</p>
<pre class="highlight"><code><span class="cm">/* Retrieve UDT value from column */</span>
<span class="k">const</span> <span class="nc">CassValue</span><span class="o">*</span> <span class="n">udt_value</span> <span class="o">=</span> <span class="nb">cass_row_get_column_by_name</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s">"value1"</span><span class="p">);</span>

<span class="cm">/* Create an iterator for the UDT value */</span>
<span class="nc">CassIterator</span><span class="o">*</span> <span class="n">udt_iterator</span> <span class="o">=</span> <span class="nb">cass_iterator_from_user_type</span><span class="p">(</span><span class="n">udt_value</span><span class="p">);</span>

<span class="cm">/* Iterate over the UDT fields */</span>
<span class="k">while</span> <span class="p">(</span><span class="nb">cass_iterator_next</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">field_name</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">field_name_length</span><span class="p">;</span>
  <span class="cm">/* Get UDT field name */</span>
  <span class="nb">cass_iterator_get_user_type_field_name</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">,</span>
                                         <span class="o">&amp;</span><span class="n">field_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">field_name_length</span><span class="p">);</span>

  <span class="cm">/* Get UDT field value */</span>
  <span class="k">const</span> <span class="nc">CassValue</span><span class="o">*</span> <span class="n">field_value</span> <span class="o">=</span>
    <span class="nb">cass_iterator_get_user_type_field_value</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">);</span>

  <span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="cm">/* The UDT iterator needs to be freed */</span>
<span class="nb">cass_iterator_free</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">);</span>
</code></pre>


        </div>
        <div class="col-md-3">
          <div id="navigation" class="panel-group side-nav" data-spy="affix" data-offset-top="60" data-offset-bottom="80" role="tablist" aria-multiselectable="true">
            <div id="table-of-contents-panel" class="panel panel-default">
              <div id="table-of-contents-heading" class="panel-heading" role="tab">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#table-of-contents" aria-expanded="true" aria-controls="table-of-contents">
                    Contents<i class="pull-right glyphicon glyphicon-chevron-up"></i>
                  </a>
                </h4>
              </div>
              <div id="table-of-contents" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="table-of-contents-heading">
                <div class="panel-body">
                  <ol class="nav nav-pills nav-stacked toc">
<li><a href="#creating-a-udt-from-schema">Creating a UDT from Schema
</a></li>
<li><a href="#manually-constructing-a-udt-data-type">Manually Constructing a UDT Data Type
</a></li>
<li><a href="#consuming-values-from-a-udt-result">Consuming values from a UDT result
</a></li>
</ol>
                </div>
              </div>
            </div>

            
          </div>
        </div>
      </div>
    </div>

    

    <script src="../../../js/jquery.js"></script>
    <script src="../../../js/bootstrap.js"></script>
    <script src="../../../js/angular.js"></script>
    <script src="../../../js/mousetrap.js"></script>
    <script src="../../../js/hotkeys.js"></script>
    <script src="../../../js/ZeroClipboard.js"></script>
    <script src="../../../js/lunr.js"></script>
    <script src="../../../js/app.js"></script>
  </body>
</html>
